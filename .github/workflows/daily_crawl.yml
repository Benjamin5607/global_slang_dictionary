name: Daily Slang Crawl

on:
  schedule:
    - cron: "0 0 * * *"  # ë§¤ì¼ UTC 00:00 (í•œêµ­ ì‹œê°„ ì˜¤ì „ 9:00)
  workflow_dispatch:     # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

# GitHub ë ˆí¬ì— ì“¸ ìˆ˜ ìˆëŠ” ê¶Œí•œ ë¶€ì—¬
permissions:
  contents: write

jobs:
  crawl-and-sync:
    runs-on: ubuntu-latest

    steps:
      # 1. ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. íŒŒì´ì¬ ì„¸íŒ…
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          cache: 'pip'

      # 3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: Install Dependencies
        run: |
          pip install -r requirements.txt

      # 4. í¬ë¡¤ëŸ¬ 4ëŒ€ì¥ ì¶œê²© (ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰)
      - name: Run Crawlers
        run: |
          mkdir -p output
          python crawlers/urban_dictionary.py || echo "âš ï¸ Urban failed"
          python crawlers/wiktionary_slang.py || echo "âš ï¸ Wiki failed"
          python crawlers/reddit_slang.py || echo "âš ï¸ Reddit failed"
          python crawlers/github_lists.py || echo "âš ï¸ GitHub Lists failed"

      # 5. ë°ì´í„° í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°
      - name: Run Deduplication
        run: |
          python pipeline/deduplicate.py

      # 6. ê²°ê³¼ íŒŒì¼ GitHubì— ì €ì¥ (Commit & Push)
      - name: Commit & Push Changes
        run: |
          git config --global user.name "SlangBot"
          git config --global user.email "bot@slang.com"
          
          # ë³€ê²½ëœ íŒŒì¼ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹
          git add output/raw_terms_clean.csv
          git commit -m "ğŸ”¥ Daily Update: Slang Data" || exit 0
          git push

      # 7. ì•±ìŠ¤í¬ë¦½íŠ¸ ê¹¨ìš°ê¸° (Webhook)
      - name: Trigger Apps Script
        run: |
          echo "ğŸ”” Waking up Google Sheets..."
          curl -L "${{ secrets.GAS_WEBHOOK_URL }}"
