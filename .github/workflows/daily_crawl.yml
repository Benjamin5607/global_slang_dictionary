import requests
import csv
import os
from bs4 import BeautifulSoup

os.makedirs("output", exist_ok=True)
OUTPUT = "output/raw_terms_wiktionary.csv"

# ì–¸ì–´ë³„ ì¹´í…Œê³ ë¦¬ ì •í™•í•œ ëª…ì¹­
LANGS = {
    "ko": "Korean_slang",
    "ja": "Japanese_slang",
    "fr": "French_slang",
    "de": "German_slang",
    "ru": "Russian_slang",
    "es": "Spanish_slang",
    "pt": "Portuguese_slang",
    "it": "Italian_slang"
}

def run():
    print("ğŸš€ Wiktionary Crawling Start...")
    rows = []
    headers = {
        "User-Agent": "Mozilla/5.0"
    }

    for lang, category in LANGS.items():
        # URL ë’¤ì— ?limit=500 ë¶™ì—¬ì„œ í•œ ë²ˆì— ë§ì´ ê°€ì ¸ì˜¤ê¸°
        url = f"https://en.wiktionary.org/wiki/Category:{category}"
        try:
            res = requests.get(url, headers=headers, timeout=10)
            res.encoding = 'utf-8' # ğŸ› ï¸ í•œê¸€ ê¹¨ì§ ë°©ì§€ ê°•ì œ ì¸ì½”ë”©
            
            if res.status_code != 200:
                continue
            
            soup = BeautifulSoup(res.text, "html.parser")
            category_groups = soup.find_all("div", class_="mw-category-group")
            
            for group in category_groups:
                links = group.find_all("a")
                for link in links:
                    term = link.get_text() # ğŸ› ï¸ í™”ë©´ì— ë³´ì´ëŠ” ê¸€ì ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜´ (ì›ì–´)
                    if term:
                        rows.append([
                            term,
                            f"Wiktionary ({category})",
                            "Wiktionary",
                            lang,
                            lang.upper()
                        ])
        except Exception as e:
            print(f"âŒ Error in {lang}: {e}")

    # utf-8-sigë¡œ ì €ì¥í•´ì•¼ ì—‘ì…€/ìœˆë„ìš°ì—ì„œ ì•ˆ ê¹¨ì§
    with open(OUTPUT, "w", newline="", encoding="utf-8-sig") as f:
        writer = csv.writer(f)
        writer.writerow(["term", "definition", "source", "language", "country"])
        writer.writerows(rows)
        
    print(f"âœ… Wiktionary finished. {len(rows)} terms saved.")

if __name__ == "__main__":
    run()
